# Pub Pol 590 Project: Propitious Selection

## Data Source:

This data comes from the National Longitudinal Study of Adolescent Health (Add Health Study). Data and documentation can be downloaded from ICPSR, study number 21600.  

Download page: http://www.icpsr.umich.edu/icpsrweb/ICPSR/studies/21600  

For this project, I used the wave 4 public access data (DS0023), the wave 4 weights (DS0029), the wave 1 public access data (DS0001), and the wave 1 contextual information (DS0019). Once downloaded, these sources can be merged using the DO file dataset_raw.do (see section on DO Files for more info).

## Directory Setup

You can set up the main directory for this project anywhere on your computer. For best performance, you should have the following subdirectories in the main directory, spelled and capitalized exactly as shown. Folders within these subfolders are indented where applicable.

*	DO_Files
*	Descriptives
*	R_Files
*	ICPSR_downloads (subfolders: DS0001, DS0019, DS0023, DS0029)

## DO Files

### proselectdir.ado

This ADO file defines a command to change Stata's working directory to whichever directory is specified in this file. Once you have set up your main directory and downloaded the appropriate files, you should first edit this file with the location of your main project directory. Then save a copy of this file in the ado "plus" folder on your system (for Windows users, this should be C:\ado\plus). You should put a "p" subfolder in the plus folder if one does not already exist. Save this file in that "p" subfolder. Then Stata should recognize and be able to run the command "proselectdir." All DO files call this command first to set the sorking directory. By using this ADO file, you will only have to specify your project directory in one location (rather than in every DO file).

### dataset_raw.do

*Datasets directly affected: raw_data.dta*  

This DO file merges the datasets downloaded from ICPSR into a single dataset. The labels are included in the ICPSR downloads, and are not affected by this DO file. This file also runs missing_data.do to handle missing values for the variables that will be used in analysis.

### missing_data.do

*Datasets directly affected: raw_data.dta*  

*Run by: dataset_raw.do*  

This DO file changes missing values from numeric codes like 7 or 9997 to Stata's missing value codes (., .d, etc.). It is based on code from the supplemental DO files that come with ICPSR downloads 21600-0001 (for wave 1 questions) and 21600-0023 (for wave 4). To preserve information about the type of missingness, I use missing value codes as follows (this legend is also found in the DO file):

*	. = legitimate skip/ no response (usually coded as 7). This includes those who were in Wave 1 but not Wave 4.
*	.r = refused (usually 6)
*	.d = don't know (usually 8)
*	.n = not applicable (usually 9) or not asked on wave 4 pretest (usually 5)

This DO file only affects the variables that will ultimately end up in clean_data.dta. The code to handle missing values for other variables is in the ICPSR supplemental DO files.

### dataset.do

*Datasets directly affected: clean_data.dta*  

This creates the clean data file for analysis. It keeps only varibles that are related to the analysis, and renames most of those variables so they are easier to remember and understand while working/coding.

### descriptives.do

*Files created: (UPDATE)*

This DO file creates tables of descriptive statistics. The tables are exported to XML files, created directly by the DO file. 

### group_means.do

(fold this one into descriptives for simplicity)

### factors.do

This DO file performs confirmatory factor analysis on the Big Five personality measures. The purpose is to confirm that adiditve indices are appropriate for use in the model.

### missingness (CHANGE NAME)

Some of the variables used in analysis had significant amounts of missing data. This DO file creates a 

### models.do

All of the models in the paper are generated by this DO file, along with various model statistics (some of which also appear in the paper). The DO file writes model results to XML files. Some models mentioned but not included in the paper are also generated here. Finally, the conditional probability graphs based on the multinomial logit models are generated here.

### page_stats.do

There are various statistics in the paper which are mentioned on their own and are not found in any descriptive or model tables. Most of these numbers come directly from my data. This DO file creates those statistics. Other numbers in the paper which come from other sources are cited appropriately.

## Other Code Files

The following code files perform formatting operations for tables and figures. No new information is generated by these files.

### R Code

In the R code folder is some R code to generate the final versions of figures and graphs. These R code files can be run on their own, as long as the data files are in the proper locations.

### Visual Basic Script for Tables

To provide consistent formatting for tables, I provide a VBA script that formats the XML tables exported from Stata. This script only deletes irrelevant data and makes formatting changes.

## Makefile

The makefile for this project keeps track of changes to code used to generate all datasets and graphics. The only exception is that the proselectdir ADO file is not tracked. Use the makefile to automatically regenerate datasets and DO files that need to be changed based on changes to earlier dependencies.

## To do:

*	merge descriptives and group means DO files
*	finish descriptives.do
	*	get desired stats
	*	supplemental stat tables?
	*	write results to files; separate table for each file
*	change name of missingness DO file to "imputations" and finish the coding
*	clean up models DO file if necessary
*	write page_stats code
*	Move all code files (do, r, vba) into single "code" folder? would have to change directory description accordingly...
*	write R code for graphics?
*	VBA script for formatting tables?
*	this would be a good time to figure out how to do better reference lists with TeX...
